总流程：forgetpwd.html-->ForgetPwdForm()-->forgetPwdView()-->send_register_email()-->点击邮件链接-->ResetPwdView()-->password_reset.html-->ModifyPwdForm()-->ModifyPwdView()

# 忘记密码
class ForgetPwdView(View):
	def get(self, request):
		forgetpwd_form = ForgetPwdForm()
		return render(request, "forgetpwd.html", {'forgetpwd_form': forgetpwd_form})

	def post(self, request):
		forgetpwd_form = ForgetPwdForm(request.POST)
		if forgetpwd_form.is_valid():
			email = request.P email", "")
			send_rigister_mail(email, "forget")

			<
				def send_register_email(email, send_type):
					email_record = EmailVerifyRecord()
					code = generate_random_string(16)
					email_record.code = code
					email_record.email = email
					email_record.send_type = send_type
					email.save()

					if send_type == "forget":
						email_titel = "慕学在线"
						email_body = "请点击下面链接激活账号：http://127.0.0.1:8000/reset/{0}".format(code)
						send_status = send_email(email_title, email_body, EMAIL_FROM, [email])
						if send_status:
							pass
			>

			return render(request, "send_success.html", {'forgetpwd_form': forgetpwd_form})
		else:
			return render(request, "forgetpwd.html", {'forgetpwd_form': forgetpwd_form})


# 处理邮件链接
class ResetPwdView(View):
	def get(self, requset, reset_code):
		record = EmailVerifyRecord.objects.filter(code=reset_code)
		if record:
			email = record.email
			return render(request, "password_reset.html", {'email': email})
		else:
			return render(request, "active_failed.html", {})


# 重置密码
class ModifyPwdView(View):
	def post(self, request):
		modifypwd_form = ModifyPwdForm(request.POST)
		if modifypwd_form.is_valid()；
			pwd1 = request.POST.get("password1", "")
			pwd2 = request.POST.get("password2", "")
			email = request.POST.get("email", "")
			if pwd1 != pwd2:
				return render(request, "password_reset.html", {'email': email, 'msg': "密码不一致"})
			user = UserProfile.objects.get(email=email)
			user.password = make_password(pwd1)
			user.save()
			return render(request, "login.html", {})
		else:
			email = request.POST.get("email", "")
			return render(request, "password_reset.html", {'email': email, 'modifypwd_form': modfifypwd_form})